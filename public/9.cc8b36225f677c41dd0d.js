(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{xjgd:function(e,n,l){"use strict";l.r(n);var t=l("CcnG"),o=function(){return function(){}}(),a=l("pMnS"),s=l("ZBxj"),d=l("G/xV"),r=l("VSng"),i=l("AcEf"),u=l("T+K8"),p=l("gIcY"),c=l("eW6I"),m=l("J0kW"),b=l("eFDZ"),S=l("NCbS"),h=l("HA+t"),g=l("6h/C"),f=l("F5IH"),C=l("klSw"),V=l("67Y/"),v=function(){function e(e){this.serverService=e}return e.prototype.getSmb2SapCompanyData=function(e){var n=this;return this.smbSapCompaniesData$?e():this.smbSapCompaniesData$=this.serverService.get("smb2sap",e).pipe(Object(C.a)(1),Object(V.a)((function(e){return{SapCompanies:e.SapCompanies,SmbCompanies:e.SmbCompanies.map((function(l){return n.updateSmbVendor(l,e.SmbCompanies,e.SapCompanies)}))}}))),this.smbSapCompaniesData$},e.prototype.updateSmb2SapCompanyData=function(e,n){return this.serverService.post("smb2sap",n,e)},e.prototype.getSapTableColumns=function(){return[new g.a({field:"VendorName",header:"Подрядчик SAP"}),new g.a({field:"SmbVendorName",header:"Подрядчик SMB"}),new g.a({field:"Details",header:"Затраты по ДО"}),new g.a({field:"Agreements",header:"Договоры"}),new g.a({field:"Services",header:"Услуги"})]},e.prototype.updateSmbVendor=function(e,n,l){if(!e)return e;var t=l.filter((function(n){return n.UidSmbCompany===e.Code})),o=n.filter((function(n){return n.ParentId&&n!==e})).filter((function(n){return n.ParentId===e.Code}));return e.SapVendors=t,e.Children=o,e.Label=e.VendorName+" ("+e.Lines.join(",")+"); Сопоставлено: "+t.length,e.SapVendors.forEach((function(n){n.SmbVendorName=e.VendorName,n.Label=n.VendorName+"; "+n.Details})),e},e.ngInjectableDef=t["ɵɵdefineInjectable"]({factory:function(){return new e(t["ɵɵinject"](f.a))},token:e,providedIn:"root"}),e}(),_=function(){function e(e,n,l,t){this.smbSapService=e,this.toastService=n,this.tableService=l,this.route=t,this.smbSapListHeight="15vh"}return e.prototype.ngOnInit=function(){var e=this;this.sapCode=this.route.snapshot.paramMap.get("id"),this.isLoading=!0,this.smbSapService.getSmb2SapCompanyData((function(){e.isLoading=!1,setTimeout((function(){return e.getHeightDifference()}),100)})).subscribe((function(n){e._smbVendors=n.SmbCompanies,e.sapVendors=n.SapCompanies,e.selectedSmbVendor=e.smbVendors[0],e.selectedSapVendor=e.sapCode?n.SapCompanies.filter((function(n){return n.Code===e.sapCode}))[0]:e.sapVendors[0],e._selectedSmbSapVendor=e.selectedSmbVendor.SapVendors?e.selectedSmbVendor.SapVendors[0]:null,e.onSmbSapSelect(e.sapCode?e.selectedSapVendor:e._selectedSmbSapVendor)})),this.cols=this.smbSapService.getSapTableColumns()},Object.defineProperty(e.prototype,"smbVendors",{get:function(){return(this._smbVendors?this.onlyUnmatched?this._smbVendors.filter((function(e){return!e.SapVendors.length})):this._smbVendors:[]).filter((function(e){return!e.ParentId}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedSmbVendor",{get:function(){return this._selectedSmbVendor},set:function(e){this._selectedSmbVendor=e,this.selectedSmbSapVendor=this.selectedSmbVendor&&this.selectedSmbVendor.SapVendors?this.selectedSmbVendor.SapVendors[0]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smbSapVendors",{get:function(){return this.selectedSmbVendor?this.selectedSmbVendor.SapVendors:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedSmbSapVendor",{get:function(){return this._selectedSmbSapVendor},set:function(e){this._selectedSmbSapVendor=e,this.selectedSapVendor&&e&&this.selectedSapVendor.Code!==e.Code&&this.onSmbSapSelect(e)},enumerable:!0,configurable:!0}),e.prototype.onAddSapSpp=function(){var e=this;if(this.selectedSapVendor.UidSmbCompany){var n=this.smbVendors.filter((function(n){return n.Code===e.selectedSapVendor.UidSmbCompany}))[0];this.selectedSapVendor.UidSmbCompany=null,this.smbSapService.updateSmbVendor(n,this.smbVendors,this.sapVendors)}this.selectedSapVendor.UidSmbCompany=this._selectedSmbVendor.Code,this.smbSapService.updateSmbVendor(this._selectedSmbVendor,this.smbVendors,this.sapVendors),this._selectedSmbSapVendor=1===this.selectedSmbVendor.SapVendors.length?this.selectedSmbVendor.SapVendors[0]:this.selectedSmbSapVendor},e.prototype.onRemoveSapSpp=function(){this.selectedSmbSapVendor.UidSmbCompany=null,this.selectedSmbSapVendor.SmbVendorName=null,this.smbSapService.updateSmbVendor(this._selectedSmbVendor,this.smbVendors,this.sapVendors)},e.prototype.onSmbSapSelect=function(e){var n=this;e&&(this.sapTable?this.sapTable.scrollTo(e.Code):setTimeout((function(){return n.sapTable.scrollTo(e.Code)}),200),this.selectedSapVendor=e)},e.prototype.onSave=function(){var e=this;this.isLoading=!0,this.smbSapService.updateSmb2SapCompanyData(this.sapVendors,(function(){return e.isLoading=!1})).subscribe((function(){e.toastService.success("Подрядчики СМБ и SAP успешно сохранены!")}))},e.prototype.getHeightDifference=function(){this.smbVendors&&this.sapVendors&&this.calcTableHeight()},e.prototype.calcTableHeight=function(){this.smbVendorsListHeight=this.tableService.getElementsHeight([".header",".smb-sap__save-block","p-checkbox",".ui-table-caption"],"72px"),this.sapVendorsTableHeight=this.tableService.getElementsHeight([".header",".smb-sap__save-block",".smb-sap__vendor-list",".smb-sap__add-remove-buttons",".ui-table-caption",".ui-table-summary"],"80px")},e}(),y=l("SZbH"),M=l("ZYCi"),w=t["ɵcrt"]({encapsulation:0,styles:[[".smb-sap__save-button[_ngcontent-%COMP%]{height:30px;padding:5px}.smb-sap__right-panel[_ngcontent-%COMP%]{height:100%}.smb-sap__add-remove-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.smb-sap__add-remove-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:30px;padding:5px}[_nghost-%COMP%]  .smb-sap__vendor-list>app-list>section>.list>.ui-table>.ui-table-scrollable-wrapper{height:15vh}[_nghost-%COMP%]  .smb-sap__vendor-list>app-list>section>.list>.ui-table>.ui-table-summary{display:none}"]],data:{}});function R(e){return t["ɵvid"](0,[t["ɵqud"](671088640,1,{sapTable:0}),(e()(),t["ɵeld"](1,0,null,null,29,"div",[["class","p-grid smb-sap"]],null,null,null,null,null)),(e()(),t["ɵeld"](2,0,null,null,1,"app-loader",[],null,null,null,s.b,s.a)),t["ɵdid"](3,49152,null,0,d.a,[],{isLoading:[0,"isLoading"]},null),(e()(),t["ɵeld"](4,0,null,null,3,"div",[["class","p-col-12 smb-sap__save-block"]],null,null,null,null,null)),(e()(),t["ɵeld"](5,0,null,null,2,"button",[["class","smb-sap__save-button"],["pButton",""]],[[8,"disabled",0]],[[null,"click"]],(function(e,n,l){var t=!0;return"click"===n&&(t=!1!==e.component.onSave()&&t),t}),null,null)),t["ɵdid"](6,4341760,null,0,r.ButtonDirective,[t.ElementRef],null,null),(e()(),t["ɵted"](-1,null,["Сохранить"])),(e()(),t["ɵeld"](8,0,null,null,9,"div",[["class","p-col-5"]],null,null,null,null,null)),(e()(),t["ɵeld"](9,0,null,null,6,"p-checkbox",[["binary","true"],["label","Только несопоставленные"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"]],(function(e,n,l){var t=!0;return"ngModelChange"===n&&(t=!1!==(e.component.onlyUnmatched=l)&&t),t}),i.b,i.a)),t["ɵdid"](10,49152,null,0,u.Checkbox,[t.ChangeDetectorRef],{binary:[0,"binary"],label:[1,"label"],style:[2,"style"]},null),t["ɵpod"](11,{marginBottom:0}),t["ɵprd"](1024,null,p.NG_VALUE_ACCESSOR,(function(e){return[e]}),[u.Checkbox]),t["ɵdid"](13,671744,null,0,p.NgModel,[[8,null],[8,null],[8,null],[6,p.NG_VALUE_ACCESSOR]],{model:[0,"model"]},{update:"ngModelChange"}),t["ɵprd"](2048,null,p.NgControl,null,[p.NgModel]),t["ɵdid"](15,16384,null,0,p.NgControlStatus,[[4,p.NgControl]],null,null),(e()(),t["ɵeld"](16,0,null,null,1,"app-list",[["dataKey","Code"],["header","Подрядчики СМБ"],["labelKey","Label"]],null,[[null,"selectedRowChange"]],(function(e,n,l){var t=!0;return"selectedRowChange"===n&&(t=!1!==(e.component.selectedSmbVendor=l)&&t),t}),c.b,c.a)),t["ɵdid"](17,114688,null,0,m.a,[],{height:[0,"height"],labelKey:[1,"labelKey"],dataKey:[2,"dataKey"],options:[3,"options"],header:[4,"header"],readonly:[5,"readonly"],selectedRow:[6,"selectedRow"],expandable:[7,"expandable"]},{selectedRowChange:"selectedRowChange"}),(e()(),t["ɵeld"](18,0,null,null,12,"div",[["class","p-col-7 p-grid smb-sap__right-panel"]],null,null,null,null,null)),(e()(),t["ɵeld"](19,0,null,null,2,"div",[["class","p-col-12 smb-sap__vendor-list"]],null,null,null,null,null)),(e()(),t["ɵeld"](20,0,null,null,1,"app-list",[["dataKey","Code"],["header","Сопоставленные подрядчики САП"],["labelKey","Label"]],null,[[null,"selectedRowChange"]],(function(e,n,l){var t=!0,o=e.component;return"selectedRowChange"===n&&(t=!1!==o.onSmbSapSelect(l)&&t),"selectedRowChange"===n&&(t=!1!==(o.selectedSmbSapVendor=l)&&t),t}),c.b,c.a)),t["ɵdid"](21,114688,null,0,m.a,[],{height:[0,"height"],labelKey:[1,"labelKey"],dataKey:[2,"dataKey"],options:[3,"options"],header:[4,"header"],readonly:[5,"readonly"],selectedRow:[6,"selectedRow"]},{selectedRowChange:"selectedRowChange"}),(e()(),t["ɵeld"](22,0,null,null,6,"div",[["class","p-col-12 smb-sap__add-remove-buttons"]],null,null,null,null,null)),(e()(),t["ɵeld"](23,0,null,null,2,"button",[["pButton",""]],[[8,"disabled",0]],[[null,"click"]],(function(e,n,l){var t=!0;return"click"===n&&(t=!1!==e.component.onAddSapSpp()&&t),t}),null,null)),t["ɵdid"](24,4341760,null,0,r.ButtonDirective,[t.ElementRef],null,null),(e()(),t["ɵted"](-1,null,[" Добавить "])),(e()(),t["ɵeld"](26,0,null,null,2,"button",[["pButton",""]],[[8,"disabled",0]],[[null,"click"]],(function(e,n,l){var t=!0;return"click"===n&&(t=!1!==e.component.onRemoveSapSpp()&&t),t}),null,null)),t["ɵdid"](27,4341760,null,0,r.ButtonDirective,[t.ElementRef],null,null),(e()(),t["ɵted"](-1,null,["Удалить"])),(e()(),t["ɵeld"](29,0,null,null,1,"app-table",[["class","p-col-12 sap-vendors-table"],["header","Несопоставленные подрядчики САП"],["selectionMode","single"]],null,[[null,"selectedRowsChange"],["window","resize"]],(function(e,n,l){var o=!0,a=e.component;return"window:resize"===n&&(o=!1!==t["ɵnov"](e,30).onTotalCountChange()&&o),"selectedRowsChange"===n&&(o=!1!==(a.selectedSapVendor=l)&&o),o}),b.b,b.a)),t["ɵdid"](30,638976,[[1,4],["sapTable",4]],0,S.a,[h.a],{header:[0,"header"],data:[1,"data"],cols:[2,"cols"],hasGlobalSearch:[3,"hasGlobalSearch"],dataKey:[4,"dataKey"],tableHeight:[5,"tableHeight"],selectable:[6,"selectable"],selectionMode:[7,"selectionMode"],selectedRows:[8,"selectedRows"]},{selectedRowsChange:"selectedRowsChange"})],(function(e,n){var l=n.component;e(n,3,0,l.isLoading);var t=e(n,11,0,"5px");e(n,10,0,"true","Только несопоставленные",t),e(n,13,0,l.onlyUnmatched),e(n,17,0,l.smbVendorsListHeight,"Label","Code",l.smbVendors,"Подрядчики СМБ",!0,l.selectedSmbVendor,!0),e(n,21,0,l.smbSapListHeight,"Label","Code",l.smbSapVendors,"Сопоставленные подрядчики САП",!0,l.selectedSmbSapVendor),e(n,30,0,"Несопоставленные подрядчики САП",l.sapVendors,l.cols,!0,"Code",l.sapVendorsTableHeight,!0,"single",l.selectedSapVendor)}),(function(e,n){var l=n.component;e(n,5,0,l.isLoading),e(n,9,0,t["ɵnov"](n,15).ngClassUntouched,t["ɵnov"](n,15).ngClassTouched,t["ɵnov"](n,15).ngClassPristine,t["ɵnov"](n,15).ngClassDirty,t["ɵnov"](n,15).ngClassValid,t["ɵnov"](n,15).ngClassInvalid,t["ɵnov"](n,15).ngClassPending),e(n,23,0,!l.selectedSmbVendor||!l.selectedSapVendor),e(n,26,0,!l.selectedSmbSapVendor)}))}function L(e){return t["ɵvid"](0,[(e()(),t["ɵeld"](0,0,null,null,1,"app-smbsap-base",[],null,[["window","resize"]],(function(e,n,l){var o=!0;return"window:resize"===n&&(o=!1!==t["ɵnov"](e,1).getHeightDifference(l)&&o),o}),R,w)),t["ɵdid"](1,114688,null,0,_,[v,y.j,h.a,M.a],null,null)],(function(e,n){e(n,1,0)}),null)}var k=t["ɵccf"]("app-smbsap-base",_,L,{},{},[]),P=l("Ip0R"),x=l("t/Na"),D=function(){return function(){}}(),T=l("7LN8"),N=l("Fzqc"),H=l("dWZg"),O=l("qAlS"),K=l("g4HV"),j=l("nciF"),I=l("mU/a"),A=l("Czxz"),E=l("No4M"),U=l("Fa87"),B=l("KB/w"),F=l("K8Pq"),z=l("HQi4"),G=l("rmC/"),Z=l("EjV3"),q=l("66nc"),J=l("FpXt"),W=l("a8Xb");l.d(n,"SmbSapContractorsModuleNgFactory",(function(){return Y}));var Y=t["ɵcmf"](o,[],(function(e){return t["ɵmod"]([t["ɵmpd"](512,t.ComponentFactoryResolver,t["ɵCodegenComponentFactoryResolver"],[[8,[a.a,k]],[3,t.ComponentFactoryResolver],t.NgModuleRef]),t["ɵmpd"](4608,P.NgLocalization,P.NgLocaleLocalization,[t.LOCALE_ID,[2,P["ɵangular_packages_common_common_a"]]]),t["ɵmpd"](4608,p["ɵangular_packages_forms_forms_o"],p["ɵangular_packages_forms_forms_o"],[]),t["ɵmpd"](4608,h.a,h.a,[]),t["ɵmpd"](4608,f.a,f.a,[x.c]),t["ɵmpd"](4608,v,v,[f.a]),t["ɵmpd"](1073742336,P.CommonModule,P.CommonModule,[]),t["ɵmpd"](1073742336,M.n,M.n,[[2,M.s],[2,M.l]]),t["ɵmpd"](1073742336,D,D,[]),t["ɵmpd"](1073742336,T.SharedModule,T.SharedModule,[]),t["ɵmpd"](1073742336,N.a,N.a,[]),t["ɵmpd"](1073742336,H.b,H.b,[]),t["ɵmpd"](1073742336,O.ScrollingModule,O.ScrollingModule,[]),t["ɵmpd"](1073742336,K.TooltipModule,K.TooltipModule,[]),t["ɵmpd"](1073742336,j.DropdownModule,j.DropdownModule,[]),t["ɵmpd"](1073742336,p["ɵangular_packages_forms_forms_d"],p["ɵangular_packages_forms_forms_d"],[]),t["ɵmpd"](1073742336,p.FormsModule,p.FormsModule,[]),t["ɵmpd"](1073742336,I.PaginatorModule,I.PaginatorModule,[]),t["ɵmpd"](1073742336,A.TableModule,A.TableModule,[]),t["ɵmpd"](1073742336,E.MultiSelectModule,E.MultiSelectModule,[]),t["ɵmpd"](1073742336,U.InputTextModule,U.InputTextModule,[]),t["ɵmpd"](1073742336,r.ButtonModule,r.ButtonModule,[]),t["ɵmpd"](1073742336,B.CalendarModule,B.CalendarModule,[]),t["ɵmpd"](1073742336,F.SliderModule,F.SliderModule,[]),t["ɵmpd"](1073742336,u.CheckboxModule,u.CheckboxModule,[]),t["ɵmpd"](1073742336,z.OverlayPanelModule,z.OverlayPanelModule,[]),t["ɵmpd"](1073742336,G.ListboxModule,G.ListboxModule,[]),t["ɵmpd"](1073742336,Z.ProgressSpinnerModule,Z.ProgressSpinnerModule,[]),t["ɵmpd"](1073742336,q.DialogModule,q.DialogModule,[]),t["ɵmpd"](1073742336,J.a,J.a,[]),t["ɵmpd"](1073742336,W.a,W.a,[]),t["ɵmpd"](1073742336,o,o,[]),t["ɵmpd"](1024,M.j,(function(){return[[{path:"",component:_},{path:":id",component:_}]]}),[])])}))}}]);