<smb-documents-menu></smb-documents-menu> <div class="contracts-container"> <div ng-hide="data.loaded" class="full-height text-primary"> <centered-fa-spinner></centered-fa-spinner> </div> <div ng-show="data.loaded" class="container table-container container-very-wide"> <div class="view-mode-container"> <smb-double-view-switch ng-model="filter.viewMode" show-excel="true" excel-handler="getExcel()"></smb-double-view-switch> </div> <div class="box-list" st-pipe="updateTableData" st-table="data.items"> <legend>Договоры</legend> <div class="table-filters"> <div class="row"> <div class="col-md-2"> <label class="control-label col-md-5"> По ДО </label> <div class="control-filter col-md-7"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.companyId" bs-options="company.UID as company.name for company in data.companiesFilter" bs-select st-filter="'branchUID'"> <span class="caret"></span> </button> </div> </div> <div class="col-md-3"> <label class="control-label col-md-7"> По типу сервисов </label> <select selectpicker="" class="input-sm control-filter col-md-5" data-title="Все" ng-model="filter.serviceTypeId" ng-options="serviceType.id as serviceType.name for serviceType in data.serviceTypes track by serviceType.id" data-live-search="true" st-filter="'serviceType'"> </select> </div> <div class="col-md-3"> <label class="control-label col-md-7"> Статус договоров </label> <div class="control-filter col-md-5"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.contractStatusId" bs-options="status.id as status.name for status in data.contractStatuses" bs-select st-filter="'status'"> <span class="caret"></span> </button> </div> </div> <div class="col-md-3"> <label class="control-label col-md-7"> Год действия </label> <div class="control-filter col-md-5"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.contractYear" bs-options="year.id as year.name for year in data.contractYears" bs-select st-filter="'year'"> <span class="caret"></span> </button> </div> </div> </div> <div class="row"> <div class="col-md-2"> <label class="control-label col-md-5"> Поиск </label> <div class="control-filter col-md-7"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.searchCol" bs-options="col.id as col.name for col in searchCols | filter: {show: true}" bs-select st-filter="'searchField'"> <span class="caret"></span> </button> </div> </div> <div class="col-md-5 search-box"> <input st-search="{{getSearchList()}}" ng-model="filter.search" placeholder="Поиск" class="input-sm form-control" type="text"> </div> <div class="col-md-2 col-md-offset-3"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.showedCols" placeholder="столбцы" data-multiple="1" max-length-html="выбрано" bs-options="col.id as col.name for col in tableCols" bs-select> <span class="caret"></span> </button> </div> </div> </div> <div class="table-scroll" sync-horizontal-scrolls="horizontal-scroll"> <div class="scroll-table-header horizontal-scroll"> <table class="table table-striped fixed"> <thead> <tr class="table-header"> <!--<th width="100" ng-show="showCol('check')">Проверка</th>--> <th width="50">#</th> <th width="220" class="text-center" st-sort="branchName" ng-show="showCol('branchName')"> ДО </th> <th width="260" class="text-center" st-sort="externalID" ng-show="showCol('externalID')"> Номер внешний </th> <!-- <th width="220" st-sort="lotusID" ng-show="showCol('lotusID')">Номер внутренний</th> --> <th width="320" class="text-center" st-sort="contractorName" ng-show="showCol('contractorName')"> Контрагент </th> <th width="80" class="text-center" st-sort="serviceCode" ng-show="showCol('serviceCode')"> Код услуги </th> <th width="300" class="text-center" st-sort="serviceName" ng-show="showCol('serviceName')"> Тип сервиса </th> <th width="120" class="text-center" st-sort="signatureDate" ng-show="showCol('signatureDate')"> Дата заключения </th> <th width="120" class="text-center" st-sort="startDate" ng-show="showCol('startDate')"> Начало действия </th> <th width="120" class="text-center" st-sort="finalDate" ng-show="showCol('finalDate')"> Окончание действия </th> <th width="180" class="text-center" ng-show="showCol('price')"> Стоимость, без НДС </th> <th width="180" class="text-center" ng-show="showCol('priceVAT')"> Стоимость, с НДС </th> <th width="160" class="text-center" st-sort="vat" ng-show="showCol('vat')"> НДС </th> <th width="160" class="text-center" st-sort="sapSum" ng-show="showCol('sapSum')"> Стоимость в SAP </th> <th width="140" class="text-center" st-sort="linkedDocsCount" ng-show="showCol('linkedDocs')"> Договорные документы </th> <th class="scroll-cell"><span></span></th> </tr> </thead> </table> </div> <div class="scroll-table-body horizontal-scroll"> <table ng-show="data.items.length && data.tableLoaded" class="table table-striped fixed"> <tbody ng-repeat="item in data.items"> <tr class="link-btn" ng-click="showContractModal(item)"> <!--<td width="100" ng-show="showCol('check')" class="text-center">--> <!--<i class="fa fa-warning" style="color: #F19D0C;" ng-hide="checkFields(item)"></i>--> <!--<i class="fa fa-check text-success" ng-show="checkFields(item)"></i>--> <!--</td>--> <td width="50">{{data.itemsSkip + $index + 1}}</td> <td width="220" ng-show="showCol('branchName')"> {{item.branchName}} </td> <td width="260" ng-show="showCol('externalID')"> <a href="" class="link-btn" ng-show="item.link" ng-click="openLink(item.link); $event.stopPropagation()">{{item.externalID}}</a> <span ng-hide="item.link">{{item.externalID}}</span> </td> <!-- <td width="220" ng-show="showCol('lotusID')">{{item.lotusID}}</td> --> <td width="320" ng-show="showCol('contractorName')"> {{item.contractorName}} </td> <td width="80" ng-show="showCol('serviceCode')"> {{item.serviceCode}} </td> <td width="300" ng-show="showCol('serviceName')"> {{item.serviceName}} </td> <td width="120" ng-show="showCol('signatureDate')" class="text-right"> {{item.signatureDate | date:'dd.MM.yyyy'}} </td> <td width="120" ng-show="showCol('startDate')" class="text-right"> {{item.startDate | date:'dd.MM.yyyy'}} </td> <td width="120" ng-show="showCol('finalDate')" class="text-right"> {{item.finalDate | date:'dd.MM.yyyy'}} </td> <td width="180" ng-show="showCol('price')" class="text-right"> {{item.PriceCurrencyPairs | priceCurrencyPairs}} </td> <td width="180" ng-show="showCol('priceVAT')" class="text-right"> {{item.PriceVatCurrencyPairs | priceCurrencyPairs}} </td> <td width="160" ng-show="showCol('vat')" class="text-right"> {{item.vat | ruble}} </td> <td width="160" ng-show="showCol('sapSum')" class="text-right"> {{(item.sapSum | ruble) || '-'}} </td> <td width="140" ng-show="showCol('linkedDocs')" class="text-center" ng-click="showLinkedDocs = item.LinkedDocs.length && !showLinkedDocs; topIndex = data.itemsSkip + $index + 1; $event.stopPropagation(); $event.preventDefault();"> <u ng-show="item.LinkedDocs && item.LinkedDocs.length">{{item.LinkedDocs.length}} шт <i class="fa fa-caret-down" ng-hide="showLinkedDocs"></i><i class="fa fa-caret-up" ng-show="showLinkedDocs"></i></u> <span ng-hide="item.LinkedDocs && item.LinkedDocs.length">нет</span> </td> </tr> <tr class="link-btn sub-row" ng-repeat="subItem in item.LinkedDocs" ng-show="showLinkedDocs" ng-click="showContractModal(subItem)"> <!--<td width="100" ng-show="showCol('check')" class="text-center">--> <!--<i class="fa fa-warning" style="color: #F19D0C;" ng-hide="checkFields(subItem)"></i>--> <!--<i class="fa fa-check text-success" ng-show="checkFields(subItem)"></i>--> <!--</td>--> <td width="50">{{topIndex}}-{{$index + 1}}</td> <td width="220" ng-show="showCol('branchName')"> {{subItem.branchName}} </td> <td width="260" ng-show="showCol('externalID')"> {{subItem.externalID}} </td> <!-- <td width="220" ng-show="showCol('lotusID')">{{subItem.lotusID}}</td> --> <td width="320" ng-show="showCol('contractorName')"> {{subItem.contractorName}} </td> <td width="80" ng-show="showCol('serviceCode')"> {{subItem.serviceCode}} </td> <td width="300" ng-show="showCol('serviceName')"> {{subItem.serviceName}} </td> <td width="120" ng-show="showCol('signatureDate')" class="text-right"> {{subItem.signatureDate | date:'dd.MM.yyyy'}} </td> <td width="120" ng-show="showCol('startDate')" class="text-right"> {{subItem.startDate | date:'dd.MM.yyyy'}} </td> <td width="120" ng-show="showCol('finalDate')" class="text-right"> {{subItem.finalDate | date:'dd.MM.yyyy'}} </td> <td width="180" ng-show="showCol('price')" class="text-right"> {{subItem.price | customCurrency: subItem.ContractCurrency}} </td> <td width="180" ng-show="showCol('priceVAT')" class="text-right"> {{subItem.priceVAT | customCurrency: subItem.ContractCurrency}} </td> <td width="160" ng-show="showCol('vat')" class="text-right"> {{subItem.vat | ruble}} </td> <td width="160" ng-show="showCol('sapSum')" class="text-right"> {{(subItem.sapSum | ruble) || '-'}} </td> <td width="140" ng-show="showCol('link')" class="text-center" ng-click="openLink(subItem.link); $event.stopPropagation()"> <span class="fa fa-edit link-btn" ng-show="subItem.link"></span> <span ng-hide="subItem.link">-</span> </td> <td width="140" ng-show="showCol('linkedDocs')" class="text-center"> {{subItem.DocTypeName}} </td> </tr> </tbody> </table> <table class="table table-striped fixed" style="visibility: hidden; margin: 0;"> <tbody> <tr class="link-btn"> <!--<td width="100" ng-show="showCol('check')"></td>--> <td width="50"></td> <td width="220" ng-show="showCol('branchName')"></td> <td width="260" ng-show="showCol('externalID')"></td> <!-- <td width="220" ng-show="showCol('lotusID')"></td> --> <td width="320" ng-show="showCol('contractorName')"></td> <td width="80" ng-show="showCol('serviceCode')"></td> <td width="300" ng-show="showCol('serviceName')"></td> <td width="120" ng-show="showCol('signatureDate')"></td> <td width="120" ng-show="showCol('startDate')"></td> <td width="120" ng-show="showCol('finalDate')"></td> <td width="180" ng-show="showCol('price')"></td> <td width="180" ng-show="showCol('priceVAT')"></td> <td width="160" ng-show="showCol('vat')"></td> <td width="160" ng-show="showCol('sapSum')"></td> <td width="140" ng-show="showCol('linkedDocs')"></td> </tr> </tbody> </table> </div> <div ng-hide="data.tableLoaded" class="table-message"> <p class="text-center">Загрузка...</p> </div> <div ng-show="data.error" class="table-message"> <p class="text-center text-danger">Не удалось получить данные.</p> </div> </div> <div class="table-pagination"> <table style="width: 100%;"> <tbody> <tr> <td width="33%"></td> <td width="33%" class="text-center"> <div st-pagination="" st-template="views/pagination.html" st-items-by-page="filter.itemsPerPage" pages="data.pages"></div> </td> <td width="33%" class="text-right"> Документов на странице: <input type="number" min="1" max="999" limit-to="3" class="input-sm form-control" style="width: 80px; display: inline-block;" ng-blur="filter.itemsPerPageSelect = filter.itemsPerPageSelect || 10" ng-model="filter.itemsPerPageSelect" ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 500, 'blur': 0 } }" numbers-only> </td> </tr> </tbody> </table> </div> </div> </div> </div> 