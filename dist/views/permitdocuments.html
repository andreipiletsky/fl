<smb-documents-menu></smb-documents-menu> <div class="permit-documents-container"> <div ng-hide="data.loaded" class="full-height text-primary"> <centered-fa-spinner></centered-fa-spinner> </div> <div ng-show="data.loaded" class="container table-container container-very-wide"> <div class="view-mode-container"> <smb-double-view-switch ng-model="filter.viewMode" show-excel="true" excel-handler="getExcel()"></smb-double-view-switch> </div> <div class="box-list" st-pipe="updateTableData" st-table="data.items"> <legend> Разрешительная документация <!-- <div class="round-button-add ng-click-active" ng-click="addPermitDocument()" ng-show="user.CanEditRd"><i class="fa fa-plus-circle"></i> <span>Добавить</span></div> --> </legend> <div class="table-filters"> <div class="row"> <div class="col-sm-2"> <label class="control-label col-sm-5"> ДО </label> <div class="control-filter col-sm-7"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.companyId" bs-options="company.UID as company.name for company in data.companiesFilter" bs-select st-filter="'DzoId'"> <span class="caret"></span> </button> </div> </div> <div class="col-sm-3"> <label class="control-label col-sm-7"> Месторождение </label> <div class="control-filter col-sm-5"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.fieldId" bs-options="field.UID as field.name for field in data.fieldsFilter" bs-select st-filter="'LocalityId'"> <span class="caret"></span> </button> </div> </div> <div class="col-sm-2"> <label class="control-label col-sm-7"> Документы </label> <div class="control-filter col-sm-5"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.documentType" bs-options="permitDocumentType.id as permitDocumentType.name for permitDocumentType in data.permitDocumentTypesFilter" bs-select st-filter="'documentType'"> <span class="caret"></span> </button> </div> </div> <div class="col-sm-5"> <label class="control-label col-sm-2"> Дата </label> <div class="control-filter col-sm-2"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.dateColId" bs-options="col.id as col.name for col in tableDateCols" bs-select st-filter="'dateColId'"> <span class="caret"></span> </button> </div> <label class="control-label col-sm-1"> с </label> <div class="control-filter col-sm-3"> <input ng-model="filter.startDate" type="text" class="form-control input-sm" bs-datepicker data-placement="bottom-right" data-max-date="{{filter.endDate}}" st-filter="'startDate'"> </div> <label class="control-label col-sm-1"> по </label> <div class="control-filter col-sm-3"> <input ng-model="filter.endDate" type="text" class="form-control input-sm" bs-datepicker data-placement="bottom-right" data-min-date="{{filter.startDate}}" st-filter="'endDate'"> </div> </div> </div> <div class="row"> <div class="col-sm-2"> <label class="control-label col-sm-5"> Поиск </label> <div class="control-filter col-sm-7"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.searchCol" bs-options="col.id as col.name for col in searchCols | filter: {show: true}" bs-select> <span class="caret"></span> </button> </div> </div> <div class="col-sm-5 search-box"> <input st-search="{{getSearchList()}}" ng-model="filter.search" placeholder="Поиск" class="input-sm form-control" type="text"> </div> <div class="col-sm-2 col-sm-offset-3"> <button type="button" class="btn btn-sm btn-default btn-select" ng-model="filter.showedCols" placeholder="столбцы" data-multiple="1" max-length-html="выбрано" bs-options="col.id as col.name for col in tableCols" bs-select> <span class="caret"></span> </button> </div> </div> </div> <div class="table-scroll" sync-horizontal-scrolls="horizontal-scroll"> <div class="scroll-table-header horizontal-scroll"> <table class="table table-striped fixed"> <thead> <tr class="table-header"> <th width="50">#</th> <th width="60" class="text-center" ng-show="showCol('files')">Д-ты</th> <th width="220" class="text-center" st-sort="DzoName" ng-show="showCol('DzoName')">ДО</th> <th width="170" class="text-center" st-sort="LocalityName" ng-show="showCol('LocalityName')">Месторождение</th> <th width="120" class="text-center" st-sort="ClusterName" ng-show="showCol('ClusterName')">Куст</th> <th width="130" class="text-center" st-sort="WellName" ng-show="showCol('WellName')">№ скважины</th> <th width="90" class="text-center" st-sort="DrillType" ng-show="showCol('DrillType')">Цель бурения</th> <th width="105" class="text-center" st-sort="Dn7WellType" ng-show="showCol('Dn7WellType')">Тип скважины</th> <th width="110" class="text-center" st-sort="DrillBegin" ng-show="showCol('DrillBegin')">Начало бурения</th> <th width="110" class="text-center" st-sort="DrillEnd" ng-show="showCol('DrillEnd')">Окончание бурения</th> <th width="110" class="text-center" st-sort="ExploitationDate" ng-show="showCol('ExploitationDate')">Дата ввода</th> <th width="110" class="text-center" st-sort="DataVvodaVOsnovnyeFondy" ng-show="showCol('DataVvodaVOsnovnyeFondy')">Дата ввода в ОФ</th> <th width="180" class="text-center" st-sort="ProjectNumber" ng-show="showCol('ProjectNumber')">Номер проекта</th> <th width="180" class="text-center" st-sort="Ammount" ng-show="showCol('Ammount')">Потрачено</th> <th width="190" class="text-center" st-sort="UnconfirmedDocumentsAmmount" ng-show="showCol('UnconfirmedDocumentsAmmount')">Потрачено по справкам-начислениям</th> <th width="190" class="text-center" st-sort="EnteredSumInOF" ng-show="showCol('EnteredSumInOF')">Сумма ввода в ОФ</th> <th width="60" class="text-center" st-sort="UnitOfMeasure" ng-show="showCol('UnitOfMeasure')">Валюта</th> <th width="140" class="text-center" st-sort="PostingDate" ng-show="showCol('PostingDate')">Дата оприходования</th> <th width="110" class="text-center" st-sort="PostingAmount" ng-show="showCol('PostingAmount')">Стоимость прихода</th> <th width="120" class="text-center" st-sort="InventoryNumber" ng-show="showCol('InventoryNumber')">Инвентарный номер</th> <th width="100" class="text-center" st-sort="Ks11Id" ng-show="showCol('Ks11Id')">КС-11</th> <th width="100" class="text-center" st-sort="Ks14Id" ng-show="showCol('Ks14Id')">КС-14</th> <th width="100" class="text-center" st-sort="Ks23Id" ng-show="showCol('Ks23Id')">КС-23</th> <th width="120" class="text-center" st-sort="ActGornyNadzorId" ng-show="showCol('ActGornyNadzorId')">Акт горного надзора</th> <th width="160" class="text-center" st-sort="GlavGosExpertizaId" ng-show="showCol('GlavGosExpertizaId')">Гос. экспертиза</th> <th width="160" class="text-center" st-sort="EkoExpertizaId" ng-show="showCol('EkoExpertizaId')">Экол. экспертиза</th> <th width="160" class="text-center" st-sort="PromExpertizaId" ng-show="showCol('PromExpertizaId')">Пром. экспертиза</th> <th width="120" class="text-center" st-sort="PsdId" ng-show="showCol('PsdId')">Ид. ПСД</th> <th width="110" st-sort="HasAllWellDocs" ng-show="showCol('HasAllWellDocs')">Все документы</th> <th class="scroll-cell"><span></span></th> </tr> </thead> </table> </div> <div class="scroll-table-body horizontal-scroll"> <table ng-show="data.items.length && data.tableLoaded" class="table table-striped fixed"> <tbody ng-repeat="item in data.items"> <tr class="link-btn"> <td width="50">{{data.itemsSkip + $index + 1}}</td> <td width="60" ng-show="showCol('files')" class="text-center" ng-click="showFiles = !showFiles; $event.stopPropagation();"><i class="fa fa-folder-open"></i></td> <td width="220" ng-show="showCol('DzoName')">{{item.DzoName}}</td> <td width="170" ng-show="showCol('LocalityName')">{{item.LocalityName}}</td> <td width="120" ng-show="showCol('ClusterName')">{{item.ClusterName}}</td> <td width="130" ng-show="showCol('WellName')">{{item.WellName}}</td> <td width="90" ng-show="showCol('DrillType')">{{item.DrillType}}</td> <td width="105" ng-show="showCol('Dn7WellType')">{{item.Dn7WellType}}</td> <td width="110" ng-show="showCol('DrillBegin')" class="text-right">{{item.DrillBegin | date:'dd.MM.yyyy'}}</td> <td width="110" ng-show="showCol('DrillEnd')" class="text-right">{{item.DrillEnd | date:'dd.MM.yyyy'}}</td> <td width="110" ng-show="showCol('ExploitationDate')" class="text-right">{{item.ExploitationDate | date:'dd.MM.yyyy'}}</td> <td width="110" ng-show="showCol('DataVvodaVOsnovnyeFondy')" class="text-right" ng-click="user.CanEditRd && changeOFDate(item)">{{item.DataVvodaVOsnovnyeFondy | date:'dd.MM.yyyy'}}</td> <td width="180" ng-show="showCol('ProjectNumber')" ng-click="user.CanEditRd && changeProjectNumber(item)">{{item.ProjectNumber}}</td> <td width="180" ng-show="showCol('Ammount')">{{item.Ammount | ruble}}</td> <td width="190" ng-show="showCol('UnconfirmedDocumentsAmmount')">{{item.UnconfirmedDocumentsAmmount | ruble}}</td> <td width="190" ng-show="showCol('EnteredSumInOF')">{{item.EnteredSumInOF | ruble}}</td> <td width="60" ng-show="showCol('UnitOfMeasure')">{{item.UnitOfMeasure}}</td> <td width="140" ng-show="showCol('PostingDate')" class="text-right">{{item.PostingDate | date:'dd.MM.yyyy'}}</td> <td width="110" ng-show="showCol('PostingAmount')">{{item.PostingAmount | round:2}}</td> <td width="120" ng-show="showCol('InventoryNumber')">{{item.InventoryNumber}}</td> <td width="100" ng-show="showCol('Ks11Id')"> <span ng-show="item.Ks11Id"><a href="" bs-tooltip="'Открыть документ'" data-container="body" ng-click="openDocument(item.Ks11Id)">Открыть</a> <a bs-tooltip="'Удалить документ'" data-container="body" class="pull-right" href=""><i class="fa fa-times text-danger" ng-show="user.CanDeleteRd" ng-click="deleteDocument(item.Ks11Id)"></i></a></span> <span bs-tooltip="'Добавить документ'" data-container="body" ng-show="!item.Ks11Id && user.CanEditRd"><a href="" ng-click="addPermitDocument(item, 'Ks11Id')">Добавить</a></span> </td> <td width="100" ng-show="showCol('Ks14Id')"> <span ng-show="item.Ks14Id"><a href="" bs-tooltip="'Открыть документ'" data-container="body" ng-click="openDocument(item.Ks14Id)">Открыть</a> <a bs-tooltip="'Удалить документ'" data-container="body" class="pull-right" href=""><i class="fa fa-times text-danger" ng-show="user.CanDeleteRd" ng-click="deleteDocument(item.Ks14Id)"></i></a></span> <span bs-tooltip="'Добавить документ'" data-container="body" ng-show="!item.Ks14Id && user.CanEditRd"><a href="" ng-click="addPermitDocument(item, 'Ks14Id')">Добавить</a></span> </td> <td width="100" ng-show="showCol('Ks23Id')"> <span ng-show="item.Ks23Id"><a href="" bs-tooltip="'Открыть документ'" data-container="body" ng-click="openDocument(item.Ks23Id)">Открыть</a> <a bs-tooltip="'Удалить документ'" data-container="body" class="pull-right" href=""><i class="fa fa-times text-danger" ng-show="user.CanDeleteRd" ng-click="deleteDocument(item.Ks23Id)"></i></a></span> <span bs-tooltip="'Добавить документ'" data-container="body" ng-show="!item.Ks23Id && user.CanEditRd"><a href="" ng-click="addPermitDocument(item, 'Ks23Id')">Добавить</a></span> </td> <td width="120" ng-show="showCol('ActGornyNadzorId')"> <span ng-show="item.ActGornyNadzorId"><a bs-tooltip="'Открыть документ'" data-container="body" href="" ng-click="openDocument(item.ActGornyNadzorId)">Открыть</a> <a bs-tooltip="'Удалить документ'" data-container="body" class="pull-right" href=""><i class="fa fa-times text-danger" ng-show="user.CanDeleteRd" ng-click="deleteDocument(item.ActGornyNadzorId)"></i></a></span> <span bs-tooltip="'Добавить документ'" data-container="body" ng-show="!item.ActGornyNadzorId && user.CanEditRd"><a href="" ng-click="addPermitDocument(item, 'ActGornyNadzorId')">Добавить</a></span> </td> <td width="160" ng-show="showCol('GlavGosExpertizaId')"> <span ng-show="item.GlavGosExpertizaId && item.GlavGosExpertizaId !== '00000000-0000-0000-0000-000000000000'"><a bs-tooltip="'Открыть документ'" data-container="body" href="" ng-click="openDocument(item.GlavGosExpertizaId)">Открыть</a></span> <span bs-tooltip="'Добавить документ'" data-container="body" ng-show="!item.GlavGosExpertizaId && user.CanEditRd && item.PsdId"><a href="" ng-click="editPsdDocument(item)">Добавить</a></span> <span ng-show="item.GlavGosExpertizaId === '00000000-0000-0000-0000-000000000000'">Не требуется</span> <span ng-show="!item.PsdId">Отсутствует ПСД</span> </td> <td width="160" ng-show="showCol('EkoExpertizaId')"> <span ng-show="item.EkoExpertizaId && item.EkoExpertizaId !== '00000000-0000-0000-0000-000000000000'"><a href="" bs-tooltip="'Открыть документ'" data-container="body" ng-click="openDocument(item.EkoExpertizaId)">Открыть</a></span> <span bs-tooltip="'Добавить документ'" data-container="body" ng-show="!item.EkoExpertizaId && user.CanEditRd && item.PsdId"><a href="" ng-click="editPsdDocument(item)">Добавить</a></span> <span ng-show="item.EkoExpertizaId === '00000000-0000-0000-0000-000000000000'">Не требуется</span> <span ng-show="!item.PsdId">Отсутствует ПСД</span> </td> <td width="160" ng-show="showCol('PromExpertizaId')"> <span ng-show="item.PromExpertizaId && item.PromExpertizaId !== '00000000-0000-0000-0000-000000000000'"><a href="" bs-tooltip="'Открыть документ'" data-container="body" ng-click="openDocument(item.PromExpertizaId)">Открыть</a></span> <span bs-tooltip="'Добавить документ'" data-container="body" ng-show="!item.PromExpertizaId && user.CanEditRd && item.PsdId"><a href="" ng-click="editPsdDocument(item)">Добавить</a></span> <span ng-show="item.PromExpertizaId === '00000000-0000-0000-0000-000000000000'">Не требуется</span> <span ng-show="!item.PsdId">Отсутствует ПСД</span> </td> <td width="120" ng-show="showCol('PsdId')"> <span ng-show="item.PsdId"><a bs-tooltip="'Открыть документ'" data-container="body" href="" ng-click="openDocument(item.PsdId)">Открыть</a></span> </td> <td width="110" ng-show="showCol('HasAllWellDocs')"> <span ng-if="item.HasAllWellDocs">да</span> <span ng-if="!item.HasAllWellDocs">нет</span> </td> </tr> <tr ng-if="showFiles"> <td colspan="22"> <psd-files guid="item.PsdId"></psd-files> </td> </tr> </tbody> </table> <table class="table table-striped fixed" style="visibility: hidden; margin: 0;"> <tbody> <tr class="link-btn"> <td width="50"></td> <td width="60" ng-show="showCol('files')"></td> <td width="220" ng-show="showCol('DzoName')"></td> <td width="170" ng-show="showCol('LocalityName')"></td> <td width="120" ng-show="showCol('ClusterName')"></td> <td width="130" ng-show="showCol('WellName')"></td> <td width="90" ng-show="showCol('DrillType')"></td> <td width="105" ng-show="showCol('Dn7WellType')"></td> <td width="110" ng-show="showCol('DrillBegin')"></td> <td width="110" ng-show="showCol('DrillEnd')"></td> <td width="110" ng-show="showCol('ExploitationDate')"></td> <td width="110" ng-show="showCol('DataVvodaVOsnovnyeFondy')"></td> <td width="180" ng-show="showCol('ProjectNumber')"></td> <td width="180" ng-show="showCol('Ammount')"></td> <td width="140" ng-show="showCol('PostingDate')"></td> <td width="110" ng-show="showCol('PostingAmount')"></td> <td width="120" ng-show="showCol('InventoryNumber')"></td> <td width="100" ng-show="showCol('Ks11Id')"></td> <td width="100" ng-show="showCol('Ks14Id')"></td> <td width="100" ng-show="showCol('Ks23Id')"></td> <td width="120" ng-show="showCol('ActGornyNadzorId')"></td> <td width="160" ng-show="showCol('GlavGosExpertizaId')"></td> <td width="160" ng-show="showCol('EkoExpertizaId')"></td> <td width="160" ng-show="showCol('PromExpertizaId')"></td> <td width="120" ng-show="showCol('PsdId')"></td> <td width="110" ng-show="showCol('HasAllWellDocs')"></td> </tr> </tbody> </table> </div> <div ng-hide="data.tableLoaded" class="table-message"> <p class="text-center">Загрузка...</p> </div> <div ng-show="data.error" class="table-message"> <p class="text-center text-danger">Не удалось получить данные.</p> </div> </div> <div class="table-pagination"> <table style="width: 100%"> <tbody> <tr> <td width="33%"></td> <td width="33%" class="text-center"><div st-pagination="" st-template="views/pagination.html" st-items-by-page="filter.itemsPerPage" pages="data.pages"></div></td> <td width="33%" class="text-right"> Документов на странице: <input type="number" min="1" max="999" class="input-sm form-control" style="width: 80px; display: inline-block" ng-blur="filter.itemsPerPageSelect = filter.itemsPerPageSelect || 10" ng-model="filter.itemsPerPageSelect" ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 500, 'blur': 0 } }" numbers-only> </td> </tr> </tbody> </table> </div> </div> </div> </div> 